## 标题
缺乏防止签名重放攻击的保护措施

## 关系
[CWE-347：加密签名验证不当](https://cwe.mitre.org/data/definitions/347.html)

## 描述
在智能合约中，有时候需要进行签名验证，以提高可用性或节省Gas费用。为了防止签名重放攻击，一个安全的实现方法是跟踪所有已处理的消息哈希，并只处理新的消息哈希。如果一个合约没有这种控制，那么恶意用户就可以攻击它，重复处理由其他用户发送的消息哈希。

## 修复措施
为了防止签名重放攻击，请考虑以下建议：

* 存储智能合约已经处理过的每一个消息哈希。当收到新的消息时，将其与已存在的消息哈希进行对比，只有当它是新的消息哈希时，才继续执行业务逻辑。
* 在处理消息的合约地址中包含消息。这样可以确保消息只在一个合约中被使用。
* 在任何情况下，都不要生成包含签名的消息哈希。因为ecrecover函数容易受到签名可塑性的影响（参见SWC-117）。

## 参考资料
* [Medium - 由transferProxy()引入的以太坊智能合约中的重放攻击漏洞](https://medium.com/cypher-core/replay-attack-vulnerability-in-ethereum-smart-contracts-introduced-by-transferproxy-124bf3694e25)