## 标题
缺乏防止签名重放攻击的保护措施

## 关系
[CWE-347：不正确验证加密签名](https://cwe.mitre.org/data/definitions/347.html)

## 描述
有时候在智能合约中进行签名验证是必要的，以实现更好的可用性或节省燃气成本。一个安全的实现需要通过跟踪所有已处理的消息哈希并只允许处理新的消息哈希来防止签名重放攻击。一个恶意用户可以攻击一个没有这种控制的合约，并多次处理由另一个用户发送的消息哈希。

## 修复措施
为了防止签名重放攻击，请考虑以下建议：

* 存储由智能合约处理过的每个消息哈希。当接收到新消息时，与已存在的消息哈希进行对比，只有在是新的消息哈希时才继续进行业务逻辑。
* 包括处理消息的合约地址。这样确保消息只能在一个合约中使用。
* 在任何情况下都不要生成包括签名的消息哈希。ecrecover函数容易受到签名可塑性的影响（参见SWC-117）。
## 参考资料
* [Medium - 由transferProxy()引入的以太坊智能合约中的重放攻击漏洞](https://medium.com/cypher-core/replay-attack-vulnerability-in-ethereum-smart-contracts-introduced-by-transferproxy-124bf3694e25)